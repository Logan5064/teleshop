<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }
        
        .shop-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .shop-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--tg-theme-text-color, #000000);
        }
        
        .shop-description {
            font-size: 16px;
            color: var(--tg-theme-hint-color, #6c757d);
            line-height: 1.4;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            background: var(--tg-theme-secondary-bg-color, #ffffff);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .product-card:hover {
            transform: translateY(-2px);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        
        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }
        
        .product-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #6c757d);
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .product-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--tg-theme-button-color, #007bff);
            margin-bottom: 15px;
        }
        
        .buy-button {
            width: 100%;
            padding: 12px;
            background: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .buy-button:hover {
            opacity: 0.9;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--tg-theme-hint-color, #6c757d);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--tg-theme-hint-color, #6c757d);
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            background: #f8d7da;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div>üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–≥–∞–∑–∏–Ω...</div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º ID –º–∞–≥–∞–∑–∏–Ω–∞ –∏–∑ URL
        const shopId = window.location.pathname.split('/').pop();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞
        async function loadShop() {
            try {
                console.log(`üîç –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–≥–∞–∑–∏–Ω —Å ID: ${shopId}`);
                
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞
                const shopResponse = await fetch(`/api/shops/${shopId}`);
                console.log(`üì° –û—Ç–≤–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞: ${shopResponse.status}`);
                
                if (!shopResponse.ok) {
                    const errorText = await shopResponse.text();
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞: ${errorText}`);
                    throw new Error(`–ú–∞–≥–∞–∑–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω (${shopResponse.status})`);
                }
                const shop = await shopResponse.json();
                console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞:`, shop);
                
                // –ó–∞—Ç–µ–º –ø–æ–ª—É—á–∞–µ–º –¥–∏–∑–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω–∞
                const designResponse = await fetch(`/api/designs/shop/${shopId}`);
                console.log(`üé® –û—Ç–≤–µ—Ç –¥–∏–∑–∞–π–Ω–∞: ${designResponse.status}`);
                
                let design = null;
                
                if (designResponse.ok) {
                    design = await designResponse.json();
                    console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –¥–∏–∑–∞–π–Ω–∞:`, design);
                } else {
                    const errorText = await designResponse.text();
                    console.log(`‚ö†Ô∏è –î–∏–∑–∞–π–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω: ${errorText}`);
                }
                
                renderShop(shop, design);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞:', error);
                renderError(error.message);
            }
        }
        
        function renderShop(shop, design) {
            const app = document.getElementById('app');
            
            if (!design) {
                // –ï—Å–ª–∏ –¥–∏–∑–∞–π–Ω–∞ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                app.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üé®</div>
                        <h2>–î–∏–∑–∞–π–Ω –Ω–µ –≥–æ—Ç–æ–≤</h2>
                        <p>–ú–∞–≥–∞–∑–∏–Ω –µ—â–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ.</p>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –ø–æ–∑–∂–µ!</p>
                    </div>
                `;
                return;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ –¥–∏–∑–∞–π–Ω–∞
            document.documentElement.style.setProperty('--primary-color', design.primary_color || '#007bff');
            document.documentElement.style.setProperty('--secondary-color', design.secondary_color || '#6c757d');
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω
            let shopContent = '';
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞
            if (design.banner && design.banner.title) {
                shopContent += `
                    <div class="shop-header" style="background: ${design.primary_color}20">
                        <div class="shop-title" style="color: ${design.primary_color}">${design.banner.title}</div>
                        ${design.banner.subtitle ? `<div class="shop-description">${design.banner.subtitle}</div>` : ''}
                    </div>
                `;
            }
            
            // –ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (design.blocks), —Ç–∞–∫ –∏ –Ω–æ–≤—ã–π (design.blocks_data)
            let blocksToRender = [];
            
            if (design.blocks_data && design.blocks_data.length > 0) {
                // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
                blocksToRender = design.blocks_data;
                console.log('üì¶ –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–ª–æ–∫–∏ –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:', blocksToRender);
            } else if (design.blocks && design.blocks.length > 0) {
                // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç
                blocksToRender = design.blocks;
                console.log('üì¶ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—ã–µ –±–ª–æ–∫–∏:', blocksToRender);
            }
            
            if (blocksToRender.length > 0) {
                blocksToRender.forEach(block => {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ properties –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –±–ª–æ–∫–∞
                    let props = block.properties || {};
                    const blockType = block.type;
                    
                    // –ï—Å–ª–∏ properties –ø—É—Å—Ç—ã–µ, —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –±–ª–æ–∫–∞
                    if (Object.keys(props).length === 0) {
                        switch (blockType) {
                            case 'hero':
                            case 'header':
                                props = {
                                    title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
                                    subtitle: '–í–∞—à –ª—É—á—à–∏–π –≤—ã–±–æ—Ä –∑–¥–µ—Å—å!'
                                };
                                break;
                            case 'product-grid':
                            case 'product-list':
                                props = {
                                    title: '–ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã',
                                    products: [
                                        { id: 1, name: "–¢–æ–≤–∞—Ä 1", description: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä", price: "1 500 ‚ÇΩ", emoji: "üì±" },
                                        { id: 2, name: "–¢–æ–≤–∞—Ä 2", description: "–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä", price: "2 300 ‚ÇΩ", emoji: "üíª" }
                                    ]
                                };
                                break;
                            case 'text':
                                props = {
                                    title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',
                                    content: '–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å...'
                                };
                                break;
                            case 'button':
                                props = {
                                    text: '–ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å',
                                    url: 'https://t.me/username'
                                };
                                break;
                            case 'contact':
                                props = {
                                    text: '–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏',
                                    url: 'https://t.me/username'
                                };
                                break;
                            case 'image':
                                props = {
                                    alt: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                                    src: null
                                };
                                break;
                            default:
                                props = { title: '–ë–ª–æ–∫ ' + blockType };
                        }
                    }
                    
                    console.log(`üß© –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫: type=${blockType}`, props);
                    
                    shopContent += renderBlock(blockType, props, design);
                });
            } else {
                // –ï—Å–ª–∏ –±–ª–æ–∫–æ–≤ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π –º–∞–∫–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
                shopContent += `
                    <div class="hero-block" style="
                        background: linear-gradient(135deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);
                        color: white;
                        padding: 40px 20px;
                        border-radius: 12px;
                        text-align: center;
                        margin-bottom: 20px;
                    ">
                        <h1 style="font-size: 28px; margin-bottom: 10px;">üåü –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
                        <p style="font-size: 16px; opacity: 0.9;">–í–∞—à –ª—É—á—à–∏–π –≤—ã–±–æ—Ä –∑–¥–µ—Å—å!</p>
                    </div>
                    
                    <div class="text-block" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 20px;
                        border-radius: 12px;
                        margin-bottom: 20px;
                        border-left: 4px solid ${design.primary_color};
                    ">
                        <h3 style="color: ${design.primary_color}; margin-bottom: 10px;">üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                    </div>
                    
                    <div class="products-section">
                        <h2 style="color: ${design.primary_color}; margin-bottom: 20px;">üè™ –¢–æ–≤–∞—Ä—ã</h2>
                        <div class="products-grid">
                            <div class="product-card">
                                <div class="product-image" style="background: linear-gradient(135deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);">
                                    üì±
                                </div>
                                <div class="product-name">–¢–æ–≤–∞—Ä 1</div>
                                <div class="product-description">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ü–µ–Ω–µ</div>
                                <div class="product-price" style="color: ${design.primary_color}">1 500 ‚ÇΩ</div>
                                <button class="buy-button" style="background: ${design.primary_color}" onclick="buyProduct(1)">
                                    üõí –ö—É–ø–∏—Ç—å
                                </button>
                            </div>
                            <div class="product-card">
                                <div class="product-image" style="background: linear-gradient(135deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);">
                                    üíª
                                </div>
                                <div class="product-name">–¢–æ–≤–∞—Ä 2</div>
                                <div class="product-description">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</div>
                                <div class="product-price" style="color: ${design.primary_color}">2 300 ‚ÇΩ</div>
                                <button class="buy-button" style="background: ${design.primary_color}" onclick="buyProduct(2)">
                                    üõí –ö—É–ø–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-block" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 20px;
                        border-radius: 12px;
                        margin-bottom: 20px;
                        border-left: 4px solid ${design.primary_color};
                    ">
                        <h3 style="color: ${design.primary_color}; margin-bottom: 10px;">üìã –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h3>
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="margin-right: 8px;">üì±</span>
                            <span>–¢–æ–≤–∞—Ä 1 - 1000‚ÇΩ</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <span style="margin-right: 8px;">üéß</span>
                            <span>–¢–æ–≤–∞—Ä 2 - 2000‚ÇΩ</span>
                        </div>
                    </div>
                    
                    <div class="text-block" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 20px;
                        border-radius: 12px;
                        margin-bottom: 20px;
                        border-left: 4px solid ${design.primary_color};
                        text-align: center;
                    ">
                        <p>–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</p>
                    </div>
                    
                    <div class="image-placeholder" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 40px 20px;
                        border-radius: 12px;
                        text-align: center;
                        border: 2px dashed ${design.primary_color}40;
                    ">
                        <div style="font-size: 48px; margin-bottom: 10px;">üñºÔ∏è</div>
                        <p style="color: var(--text-secondary);">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                    </div>
                `;
            }
            
            app.innerHTML = shopContent;
        }
        
        function renderError(message) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="error">
                    <div style="font-size: 48px; margin-bottom: 20px;">‚ùå</div>
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">–û—à–∏–±–∫–∞</div>
                    <div>${message}</div>
                </div>
            `;
        }
        
        function buyProduct(productId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
            tg.showAlert(`–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É! ID: ${productId}`);
            
            // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç–∞
            tg.sendData(JSON.stringify({
                action: 'buy_product',
                product_id: productId,
                shop_id: shopId
            }));
        }
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É –±–ª–æ–∫–æ–≤
        const ShopBlocks = {
            header: function(props, design) {
                const title = props.title || '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
                const subtitle = props.subtitle || '';
                
                return `
                    <div class="hero-block" style="
                        background: linear-gradient(135deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);
                        color: white;
                        padding: 40px 20px;
                        border-radius: 12px;
                        text-align: center;
                        margin-bottom: 20px;
                    ">
                        <h1 style="font-size: 28px; margin-bottom: 10px;">${title}</h1>
                        ${subtitle ? `<p style="font-size: 16px; opacity: 0.9;">${subtitle}</p>` : ''}
                    </div>
                `;
            },

            hero: function(props, design) {
                // hero - —ç—Ç–æ –∞–ª–∏–∞—Å –¥–ª—è header
                return this.header(props, design);
            },

            banner: function(props, design) {
                const title = props.title || '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ';
                const subtitle = props.subtitle || '';
                
                return `
                    <div class="banner-block" style="
                        background: linear-gradient(45deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);
                        color: white;
                        padding: 30px 20px;
                        border-radius: 12px;
                        text-align: center;
                        margin-bottom: 20px;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    ">
                        <h2 style="font-size: 24px; margin-bottom: 8px;">${title}</h2>
                        ${subtitle ? `<p style="font-size: 14px; opacity: 0.9;">${subtitle}</p>` : ''}
                    </div>
                `;
            },

            text: function(props, design) {
                const title = props.title || '';
                const content = props.content || '–í–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å...';
                
                return `
                    <div class="text-block" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 20px;
                        border-radius: 12px;
                        margin-bottom: 20px;
                        border-left: 4px solid ${design.primary_color};
                    ">
                        ${title ? `<h3 style="color: ${design.primary_color}; margin-bottom: 10px;">${title}</h3>` : ''}
                        <p>${content}</p>
                    </div>
                `;
            },

            products: function(props, design) {
                const title = props.title || '–ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã';
                const products = props.products || [
                    { id: 1, name: "–¢–æ–≤–∞—Ä 1", description: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä", price: "1 500 ‚ÇΩ", emoji: "üì±" },
                    { id: 2, name: "–¢–æ–≤–∞—Ä 2", description: "–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä", price: "2 300 ‚ÇΩ", emoji: "üíª" }
                ];
                
                const productsHtml = products.map(product => `
                    <div class="product-card">
                        <div class="product-image" style="background: linear-gradient(135deg, ${design.primary_color} 0%, ${design.secondary_color || design.primary_color} 100%);">
                            ${product.emoji || 'üõçÔ∏è'}
                        </div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-price" style="color: ${design.primary_color}">${product.price}</div>
                        <button class="buy-button" style="background: ${design.primary_color}" onclick="buyProduct(${product.id})">
                            üõí –ö—É–ø–∏—Ç—å
                        </button>
                    </div>
                `).join('');
                
                return `
                    <div class="products-section">
                        <h2 style="color: ${design.primary_color}; margin-bottom: 20px;">üõçÔ∏è ${title}</h2>
                        <div class="products-grid">${productsHtml}</div>
                    </div>
                `;
            },

            'product-grid': function(props, design) {
                // product-grid - —ç—Ç–æ –∞–ª–∏–∞—Å –¥–ª—è products
                return this.products(props, design);
            },

            'product-list': function(props, design) {
                const title = props.title || '–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤';
                const products = props.products || [
                    { id: 1, name: "–¢–æ–≤–∞—Ä 1", price: "1 000 ‚ÇΩ", emoji: "üì±" },
                    { id: 2, name: "–¢–æ–≤–∞—Ä 2", price: "2 000 ‚ÇΩ", emoji: "üéß" }
                ];
                
                const productsHtml = products.map(product => `
                    <div style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 12px 16px;
                        border-radius: 8px;
                        margin-bottom: 8px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        border-left: 4px solid ${design.primary_color};
                    ">
                        <span style="font-size: 20px;">${product.emoji || 'üõçÔ∏è'}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 2px;">${product.name}</div>
                            <div style="color: ${design.primary_color}; font-weight: 600;">${product.price}</div>
                        </div>
                        <button style="
                            background: ${design.primary_color};
                            color: white;
                            border: none;
                            padding: 6px 12px;
                            border-radius: 6px;
                            font-size: 12px;
                            cursor: pointer;
                        " onclick="buyProduct(${product.id})">
                            üõí
                        </button>
                    </div>
                `).join('');
                
                return `
                    <div class="product-list-section" style="margin-bottom: 20px;">
                        <h3 style="color: ${design.primary_color}; margin-bottom: 15px;">üìã ${title}</h3>
                        ${productsHtml}
                    </div>
                `;
            },

            button: function(props, design) {
                const text = props.text || '–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏';
                const url = props.url || 'https://t.me/username';
                const color = props.color || design.primary_color;
                
                return `
                    <div class="button-block" style="text-align: center; margin-bottom: 20px;">
                        <a href="${url}" target="_blank" style="
                            display: inline-block;
                            background: ${color};
                            color: white;
                            padding: 12px 24px;
                            border-radius: 8px;
                            text-decoration: none;
                            font-weight: 600;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                        ">üìû ${text}</a>
                    </div>
                `;
            },

            contact: function(props, design) {
                const text = props.text || '–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏';
                const url = props.url || 'https://t.me/username';
                
                return `
                    <div class="contact-block" style="
                        background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                        padding: 20px;
                        border-radius: 12px;
                        text-align: center;
                        margin-bottom: 20px;
                        border: 2px solid ${design.primary_color}40;
                    ">
                        <div style="margin-bottom: 15px;">
                            <button style="
                                width: 100%;
                                background: #10b981;
                                color: white;
                                padding: 12px;
                                border: none;
                                border-radius: 8px;
                                font-weight: 500;
                                font-size: 14px;
                                cursor: pointer;
                            " onclick="window.open('${url}', '_blank')">
                                üìû ${text}
                            </button>
                        </div>
                        <div style="font-size: 12px; color: var(--tg-theme-hint-color, #64748b);">
                            Telegram: @your_shop
                        </div>
                    </div>
                `;
            },

            image: function(props, design) {
                const alt = props.alt || '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                const src = props.src;
                
                if (src) {
                    return `
                        <div class="image-block" style="margin-bottom: 20px;">
                            <img src="${src}" alt="${alt}" style="
                                width: 100%;
                                border-radius: 12px;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                            ">
                        </div>
                    `;
                } else {
                    return `
                        <div class="image-placeholder" style="
                            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
                            padding: 40px 20px;
                            border-radius: 12px;
                            text-align: center;
                            border: 2px dashed ${design.primary_color}40;
                            margin-bottom: 20px;
                        ">
                            <div style="font-size: 48px; margin-bottom: 10px; color: ${design.primary_color}40;">üñºÔ∏è</div>
                            <p style="color: var(--tg-theme-hint-color, #64748b); font-size: 14px;">${alt}</p>
                        </div>
                    `;
                }
            }
        };

        function renderBlock(blockType, props, design) {
            console.log(`üîß –†–µ–Ω–¥–µ—Ä–∏–º –±–ª–æ–∫: ${blockType}`, props);
            
            // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –∞–ª–∏–∞—Å—ã
            if (blockType === 'categories') blockType = 'products';
            if (blockType === 'hero') blockType = 'header';
            
            if (ShopBlocks[blockType]) {
                return ShopBlocks[blockType](props, design);
            } else {
                return `
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                        <strong>üîß –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–ª–æ–∫: "${blockType}"</strong><br>
                        <small>–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(props)}</small>
                    </div>
                `;
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        loadShop();
    </script>
</body>
</html> 