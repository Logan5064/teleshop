@echo off
title TeleShop Auto Tunnel Launcher
color 0A

echo.
echo ====================================================
echo         üöÄ TeleShop Auto Tunnel Launcher
echo ====================================================
echo.
echo –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å:
echo  1. üåê –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É–Ω–Ω–µ–ª—è
echo  2. üìã –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL
echo  3. ‚öôÔ∏è  –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ URL –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo  4. üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
echo.
pause

echo.
echo üåê –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è –ø–æ—Ä—Ç–∞ 3000...

:: –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è URL
set TEMP_URL_FILE=%TEMP%\teleshop_url.txt

:: –ó–∞–ø—É—Å–∫–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å –≤ —Ñ–æ–Ω–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º URL
echo –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å...
start /B cmd /c "npx localtunnel --port 3000 > %TEMP_URL_FILE% 2>&1"

:: –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è URL (–º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥)
echo –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è URL...
set /a counter=0
:WAIT_FOR_URL
timeout /t 2 /nobreak >nul
set /a counter+=1
if exist %TEMP_URL_FILE% (
    findstr "your url is:" %TEMP_URL_FILE% >nul
    if !errorlevel! equ 0 goto URL_FOUND
)
if %counter% lss 15 goto WAIT_FOR_URL

echo ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –∑–∞ 30 —Å–µ–∫—É–Ω–¥
pause
exit /b 1

:URL_FOUND
:: –ò–∑–≤–ª–µ–∫–∞–µ–º URL –∏–∑ —Ñ–∞–π–ª–∞
for /f "tokens=4" %%i in ('findstr "your url is:" %TEMP_URL_FILE%') do set PUBLIC_URL=%%i

if "%PUBLIC_URL%"=="" (
    echo ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å URL
    pause
    exit /b 1
)

echo.
echo ‚úÖ –ü–æ–ª—É—á–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π URL: %PUBLIC_URL%
echo.

echo ‚öôÔ∏è  –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω—è–µ–º URL –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...

:: –°–æ–∑–¥–∞–µ–º .env.local —Ñ–∞–π–ª —Å –ø—É–±–ª–∏—á–Ω—ã–º URL (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
echo # Auto-generated by TeleShop Auto Tunnel Launcher > 01-user-dashboard\.env.local
echo NEXT_PUBLIC_TUNNEL_URL=%PUBLIC_URL% >> 01-user-dashboard\.env.local

echo ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!
echo   - Frontend URL: %PUBLIC_URL%
echo   - Backend API: localhost:8000 (–æ—Å—Ç–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º)
echo.

echo üöÄ –®–∞–≥ 3: –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...
echo.

:: –ó–∞–ø—É—Å–∫–∞–µ–º Auth Bot
echo ü§ñ –ó–∞–ø—É—Å–∫–∞–µ–º Auth Bot...
start "TeleShop Auth Bot" cmd /k "cd auth-bot && python simple_auth_bot.py"
timeout /t 3 /nobreak >nul

:: –ó–∞–ø—É—Å–∫–∞–µ–º Backend API
echo üîß –ó–∞–ø—É—Å–∫–∞–µ–º Backend API...
start "TeleShop Backend API" cmd /k "cd 05-server-launchers\main && python main_secure_fixed.py"
timeout /t 5 /nobreak >nul

:: –ó–∞–ø—É—Å–∫–∞–µ–º Frontend
echo üåê –ó–∞–ø—É—Å–∫–∞–µ–º Frontend...
start "TeleShop Frontend" cmd /k "cd 01-user-dashboard && npm run dev"
timeout /t 3 /nobreak >nul

echo.
echo ====================================================
echo               ‚úÖ TeleShop –∑–∞–ø—É—â–µ–Ω!
echo ====================================================
echo.
echo üåê –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞: %PUBLIC_URL%
echo.
echo üìã –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
echo.
echo üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –æ–∫–Ω–∞
echo.

:: –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
del %TEMP_URL_FILE% 2>nul

echo –û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä...
start %PUBLIC_URL%

pause 